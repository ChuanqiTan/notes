
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="zh_CN">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>其它 &#8212; Chuanqi 的技术文档</title>
    <link rel="stylesheet" href="../../../_static/sphinx13.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/translations.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

    <link rel="index" title="索引" href="../../../genindex.html" />
    <link rel="search" title="搜索" href="../../../search.html" />
    <link rel="next" title="Shell 编程" href="../../bash_shell.html" />
    <link rel="prev" title="工具" href="tools.html" />
    <link rel="canonical" href="http://www.sphinx-doc.org/en/master/language/python/python_notes/others.html" />

    <!--<link href='https://fonts.googleapis.com/css?family=Open+Sans:300,400,700'-->
          <!--rel='stylesheet' type='text/css' />-->
 
    <style type="text/css">
      table.right { float: right; margin-left: 20px; }
      table.right td { border: 1px solid #ccc; }
      
      .injected { display:none; }
    </style>
    <script type="text/javascript">
      // intelligent scrolling of the sidebar content
      $(window).scroll(function() {
        var sb = $('.sphinxsidebarwrapper');
        var win = $(window);
        var sbh = sb.height();
        var offset = $('.sphinxsidebar').position()['top'];
        var wintop = win.scrollTop();
        var winbot = wintop + win.innerHeight();
        var curtop = sb.position()['top'];
        var curbot = curtop + sbh;
        // does sidebar fit in window?
        if (sbh < win.innerHeight()) {
          // yes: easy case -- always keep at the top
          sb.css('top', $u.min([$u.max([0, wintop - offset - 10]),
                                $(document).height() - sbh - 200]));
        } else {
          // no: only scroll if top/bottom edge of sidebar is at
          // top/bottom edge of window
          if (curtop > wintop && curbot > winbot) {
            sb.css('top', $u.max([wintop - offset - 10, 0]));
          } else if (curtop < wintop && curbot < winbot) {
            sb.css('top', $u.min([winbot - sbh - offset - 20,
                                  $(document).height() - sbh - 200]));
          }
        }
      });
    </script>

  </head><body>
<div class="pageheader">
  <ul>
    <li><a href="../../../index.html">博客首页</a></li>
    <li><a href="https://tanchuanqi.com" target="_blank">个人主页</a></li>
  </ul>
  <div>
    <a href="../../../index.html">
      <img src="../../../_static/sphinxheader.png" alt="SPHINX" />
    </a>
  </div>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="总目录"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="../../bash_shell.html" title="Shell 编程"
             accesskey="N">下一页</a> |</li>
        <li class="right" >
          <a href="tools.html" title="工具"
             accesskey="P">上一页</a> |</li>
        <!--<li><a href="../../../index.html">首页</a>&#160;|</li>-->
        <!--<li><a href="../../../contents.html">Documentation</a> &#187;</li>-->

          <li class="nav-item nav-item-1"><a href="../py_notes.html" accesskey="U">Python 学习笔记</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">其它</a><ul>
<li><a class="reference internal" href="#id2">编码问题</a><ul>
<li><a class="reference internal" href="#python2-x">Python2.x中的编码问题</a></li>
<li><a class="reference internal" href="#python">PYTHON-进阶-编码处理小结</a></li>
<li><a class="reference internal" href="#id3">Python的中文编码问题</a></li>
</ul>
</li>
<li><a class="reference internal" href="#centos-6-x-python">CentOs 6.x 升级 Python 版本</a></li>
</ul>
</li>
</ul>

  <h4>上一个主题</h4>
  <p class="topless"><a href="tools.html"
                        title="上一章">工具</a></p>
  <h4>下一个主题</h4>
  <p class="topless"><a href="../../bash_shell.html"
                        title="下一章">Shell 编程</a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>快速搜索</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="转向" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
    <div class="documentwrapper">
      <div class="bodywrapper">
        <div class="body" role="main">
          
  <div class="section" id="id1">
<h1>其它<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h1>
<div class="section" id="id2">
<h2>编码问题<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h2>
<div class="section" id="python2-x">
<h3>Python2.x中的编码问题<a class="headerlink" href="#python2-x" title="永久链接至标题">¶</a></h3>
<blockquote>
<div><div class="line-block">
<div class="line">字符串在Python内部的表示是unicode编码，因此，在做编码转换时，通常需要以unicode作为中间编码，即先将其他编码的字符串解码（decode）成unicode，再从unicode编码（encode）成另一种编码。</div>
<div class="line">但是，Python 2.x的默认编码格式是ASCII（因为python诞生比unicode要早），就是说，在没有指定Python源码编码格式的情况下，源码中的所有字符都会被默认为ASCII码。也因为这个根本原因，在Python 2.x中经常会遇到UnicodeDecodeError或者UnicodeEncodeError的异常。</div>
</div>
<div class="line-block">
<div class="line">为了能够处理Unicode数据，同时兼容Python某些内部模块，Python 2.x中提供了Unicode这种数据类型，通过decode和encode方法可以将其它编码和Unicode编码相互转化，但同时也引入了UnicodeDecodeError和UnicodeEncodeError异常。</div>
<div class="line">如果在文件头部没有指定文件编码类型，那么文件里的字符串字面值就是 ascii，否则就是指定的 coding 类型。</div>
</div>
<p>切记，unicode是python内部表示字符串的数据类型，py内部只理解unicode，所以：</p>
</div></blockquote>
<ul class="simple">
<li>对于非unicode编码（py内部不能原生理解的编码），就需要进行解码，所以decode是从str 到 unicode，解码的结果就是py能理解的unicode。</li>
<li>encode是从 unicode 到 str，编码就是从内部表示法到其它表示方法。</li>
</ul>
<blockquote>
<div><p>str和unicode</p>
<p>str和unicode都是basestring的子类。严格意义上说，str其实是字节串，它是unicode经过编码后的字节组成的序列。对UTF-8编码的str’汉’使用len()函数时，结果是3，因为实际上，UTF-8编码的’汉’ == ‘xE6xB1x89’。</p>
<p>unicode才是真正意义上的字符串，对字节串str使用正确的字符编码进行解码后获得，并且len(u’汉’) == 1。</p>
<p>再来看看encode()和decode()两个basestring的实例方法，理解了str和unicode的区别后，这两个方法就不会再混淆了:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">1</span>  <span class="c1"># coding: UTF-8</span>
<span class="mi">2</span>
<span class="mi">3</span>  <span class="n">u</span> <span class="o">=</span> <span class="sa">u</span><span class="s1">&#39;汉&#39;</span>
<span class="mi">4</span>  <span class="nb">print</span> <span class="nb">repr</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="c1"># u&#39;\u6c49&#39;</span>
<span class="mi">5</span>  <span class="n">s</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;UTF-8&#39;</span><span class="p">)</span>
<span class="mi">6</span>  <span class="nb">print</span> <span class="nb">repr</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="c1"># &#39;\xe6\xb1\x89&#39;</span>
<span class="mi">7</span>  <span class="n">u2</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;UTF-8&#39;</span><span class="p">)</span>
<span class="mi">8</span>  <span class="nb">print</span> <span class="nb">repr</span><span class="p">(</span><span class="n">u2</span><span class="p">)</span> <span class="c1"># u&#39;\u6c49&#39;</span>
<span class="mi">9</span>
<span class="mi">10</span> <span class="c1"># 对unicode进行解码是错误的</span>
<span class="mi">11</span> <span class="c1"># s2 = u.decode(&#39;UTF-8&#39;)</span>
<span class="mi">12</span> <span class="c1"># 同样，对str进行编码也是错误的</span>
<span class="mi">13</span> <span class="c1"># u2 = s.encode(&#39;UTF-8&#39;)</span>
</pre></div>
</div>
<p>需要注意的是，虽然对str调用encode()方法是错误的，但实际上Python不会抛出异常，而是返回另外一个相同内容但不同id的str；对unicode调用decode()方法也是这样。很不理解为什么不把encode()和decode()分别放在unicode和str中而是都放在basestring中，但既然已经这样了，我们就小心避免犯错吧。</p>
</div></blockquote>
</div>
<div class="section" id="python">
<h3>PYTHON-进阶-编码处理小结<a class="headerlink" href="#python" title="永久链接至标题">¶</a></h3>
<ul class="simple">
<li><a class="reference external" href="http://wklken.me/posts/2013/08/31/python-extra-coding-intro.html">Python-进阶-编码处理小结</a></li>
<li><a class="reference external" href="http://wklken.me/posts/2013/08/31/python-extra-coding-intro.html#_1">开始</a></li>
<li><a class="reference external" href="http://wklken.me/posts/2013/08/31/python-extra-coding-intro.html#_2">首先</a></li>
<li><a class="reference external" href="http://wklken.me/posts/2013/08/31/python-extra-coding-intro.html#str-unicode">str 和 unicode</a></li>
<li><a class="reference external" href="http://wklken.me/posts/2013/08/31/python-extra-coding-intro.html#ide">文件处理,IDE和控制台</a></li>
<li><a class="reference external" href="http://wklken.me/posts/2013/08/31/python-extra-coding-intro.html#_3">建议</a></li>
<li><a class="reference external" href="http://wklken.me/posts/2013/08/31/python-extra-coding-intro.html#_4">相关模块及一些方法</a></li>
</ul>
<blockquote>
<div><p>整理下python编码相关的内容</p>
<p>注意: 以下讨论为Python2.x版本, Py3k的待尝试</p>
<p>开始</p>
<p>用python处理中文时，读取文件或消息，http参数等等</p>
<p>一运行，发现乱码(字符串处理，读写文件，print)</p>
<p>然后，大多数人的做法是，调用encode/decode进行调试，并没有明确思考为何出现乱码</p>
<p>所以调试时最常出现的错误</p>
<p>错误1</p>
<div class="line-block">
<div class="line">Traceback (most recent call last):</div>
<div class="line">File “&lt;stdin&gt;”, line 1, in &lt;module&gt;</div>
<div class="line">UnicodeDecodeError: ‘ascii’ codec can’t decode byte 0xe6 in position 0: ordinal not in range(128)</div>
</div>
<p>错误2</p>
<div class="line-block">
<div class="line">Traceback (most recent call last):</div>
<div class="line">File “&lt;stdin&gt;”, line 1, in &lt;module&gt;</div>
<div class="line">File “/System/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/encodings/utf_8.py”, line 16, in decode</div>
<div class="line">return codecs.utf_8_decode(input, errors, True)</div>
<div class="line">UnicodeEncodeError: ‘ascii’ codec can’t encode characters in position 0-1: ordinal not in range(128)</div>
</div>
<p>首先</p>
<p>必须有大体概念，了解下字符集，<a class="reference external" href="http://zh.wikipedia.org/wiki/%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81">字符编码</a></p>
<p><a class="reference external" href="http://zh.wikipedia.org/zh/ASCII">ASCII</a>&nbsp;<a href="#id4"><span class="problematic" id="id5">|&nbsp;`Unicode &lt;http://zh.wikipedia.org/zh/Unicode&gt;`__&nbsp;|</span></a>&nbsp;<a class="reference external" href="http://zh.wikipedia.org/zh/UTF-8">UTF-8</a>&nbsp;| 等等</p>
<p><a class="reference external" href="http://www.ruanyifeng.com/blog/2007/10/ascii_unicode_and_utf-8.html">字符编码笔记：ASCII，Unicode和UTF-8</a></p>
<p><a class="reference external" href="http://www.searchtb.com/2012/04/chinese_encode.html">淘宝搜索技术博客-中文编码杂谈</a></p>
<p>str 和 unicode</p>
<p>str和unicode都是basestring的子类</p>
<p>所以有判断是否是字符串的方法</p>
<div class="line-block">
<div class="line">def is_str(s):</div>
<div class="line">return isinstance(s, basestring)</div>
</div>
<p>str和unicode 转换</p>
<p>decode&nbsp;<a class="reference external" href="http://www.tutorialspoint.com/python/string_decode.htm">文档</a></p>
<p>encode&nbsp;<a class="reference external" href="http://www.tutorialspoint.com/python/string_encode.htm">文档</a></p>
<div class="line-block">
<div class="line">str -&gt; decode(‘the_coding_of_str’) -&gt; unicode</div>
<div class="line">unicode -&gt; encode(‘the_coding_you_want’) -&gt; str</div>
</div>
<p>区别</p>
<p>str是字节串，由unicode经过编码(encode)后的字节组成的</p>
<p>声明方式</p>
<div class="line-block">
<div class="line">s = ‘中文’</div>
<div class="line">s = u’中文’.encode(‘utf-8’)</div>
</div>
<div class="line-block">
<div class="line">&gt;&gt;&gt; type(‘中文’)</div>
<div class="line">&lt;type ‘str’&gt;</div>
</div>
<p>求长度(返回字节数)</p>
<div class="line-block">
<div class="line">&gt;&gt;&gt; u’中文’.encode(‘utf-8’)</div>
<div class="line">‘xe4xb8xadxe6x96x87’</div>
<div class="line">&gt;&gt;&gt; len(u’中文’.encode(‘utf-8’))</div>
<div class="line">6</div>
</div>
<p>unicode才是真正意义上的字符串，由字符组成</p>
<p>声明方式</p>
<div class="line-block">
<div class="line">s = u’中文’</div>
<div class="line">s = ‘中文’.decode(‘utf-8’)</div>
<div class="line">s = unicode(‘中文’, ‘utf-8’)</div>
</div>
<div class="line-block">
<div class="line">&gt;&gt;&gt; type(u’中文’)</div>
<div class="line">&lt;type ‘unicode’&gt;</div>
</div>
<p>求长度(返回字符数),在逻辑中真正想要用的</p>
<div class="line-block">
<div class="line">&gt;&gt;&gt; u’中文’</div>
<div class="line">u’u4e2du6587’</div>
<div class="line">&gt;&gt;&gt; len(u’中文’)</div>
<div class="line">2</div>
</div>
<p>结论</p>
<p>搞明白要处理的是str还是unicode, 使用对的处理方法(str.decode/unicode.encode)</p>
<p>下面是判断是否为unicode/str的方法</p>
<div class="line-block">
<div class="line">&gt;&gt;&gt; isinstance(u’中文’, unicode)</div>
<div class="line">True</div>
<div class="line">&gt;&gt;&gt; isinstance(‘中文’, unicode)</div>
<div class="line">False</div>
</div>
<div class="line-block">
<div class="line">&gt;&gt;&gt; isinstance(‘中文’, str)</div>
<div class="line">True</div>
<div class="line">&gt;&gt;&gt; isinstance(u’中文’, str)</div>
<div class="line">False</div>
</div>
<p>简单原则：不要对str使用encode，不要对unicode使用decode (事实上可以对str进行encode的，具体见最后，为了保证简单，不建议)</p>
<div class="line-block">
<div class="line">&gt;&gt;&gt; ‘中文’.encode(‘utf-8’)</div>
<div class="line">Traceback (most recent call last):</div>
<div class="line">File “&lt;stdin&gt;”, line 1, in &lt;module&gt;</div>
<div class="line">UnicodeDecodeError: ‘ascii’ codec can’t decode byte 0xe4 in position 0: ordinal not in range(128)</div>
</div>
<div class="line-block">
<div class="line">&gt;&gt;&gt; u’中文’.decode(‘utf-8’)</div>
<div class="line">Traceback (most recent call last):</div>
<div class="line">File “&lt;stdin&gt;”, line 1, in &lt;module&gt;</div>
<div class="line">File “/System/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/encodings/utf_8.py”, line 16, in decode</div>
<div class="line">return codecs.utf_8_decode(input, errors, True)</div>
<div class="line">UnicodeEncodeError: ‘ascii’ codec can’t encode characters in position 0-1: ordinal not in range(128)</div>
</div>
<p>不同编码转换,使用unicode作为中间编码</p>
<div class="line-block">
<div class="line">#s是code_A的str</div>
<div class="line">s.decode(‘code_A’).encode(‘code_B’)</div>
</div>
<p>文件处理,IDE和控制台</p>
<p>处理流程，可以这么使用，把python看做一个水池，一个入口，一个出口</p>
<p>入口处，全部转成unicode, 池里全部使用unicode处理，出口处，再转成目标编码(当然，有例外，处理逻辑中要用到具体编码的情况)</p>
<p>读文件</p>
<p>外部输入编码，decode转成unicode</p>
<p>处理(内部编码，统一unicode)</p>
<p>encode转成需要的目标编码</p>
<p>写到目标输出(文件或控制台)</p>
<p>IDE和控制台报错，原因是print时，编码和IDE自身编码不一致导致</p>
<p>输出时将编码转换成一致的就可以正常输出</p>
<div class="line-block">
<div class="line">&gt;&gt;&gt; print u’中文’.encode(‘gbk’)</div>
<div class="line">&gt;&gt;&gt; print u’中文’.encode(‘utf-8’)</div>
<div class="line">中文</div>
</div>
<p>建议</p>
<p>规范编码</p>
<p>统一编码，防止由于某个环节产生的乱码</p>
<p>环境编码，IDE/文本编辑器, 文件编码，数据库数据表编码</p>
<p>保证代码源文件编码</p>
<p>这个很重要</p>
<p>py文件默认编码是ASCII, 在源代码文件中，如果用到非ASCII字符，需要在文件头部进行编码声明&nbsp;<a class="reference external" href="http://www.python.org/dev/peps/pep-0263/">文档</a></p>
<p>不声明的话，输入非ASCII会遇到的错误,必须放在文件第一行或第二行</p>
<div class="line-block">
<div class="line">File “XXX.py”, line 3</div>
<div class="line">SyntaxError: Non-ASCII character ‘xd6’ in file c.py on line 3, but no encoding declared; see <a class="reference external" href="http://www.python.org/peps/pep-0263.html">http://www.python.org/peps/pep-0263.html</a> for details</div>
</div>
<p>声明方法</p>
<div class="line-block">
<div class="line"># – coding: utf-8 –</div>
<div class="line">或者</div>
<div class="line">#coding=utf-8</div>
</div>
<p>若头部声明coding=utf-8, a = ‘中文’ 其编码为utf-8</p>
<p>若头部声明coding=gb2312, a = ‘中文’ 其编码为gbk</p>
<p>so, 同一项目中所有源文件头部统一一个编码,并且声明的编码要和源文件保存的编码一致(编辑器相关)</p>
<p>在源代码用作处理的硬编码字符串，统一用unicode</p>
<p>将其类型和源文件本身的编码隔离开, 独立无依赖方便流程中各个位置处理</p>
<div class="line-block">
<div class="line">if s == u’中文’: #而不是 s == ‘中文’</div>
<div class="line">pass</div>
<div class="line">#注意这里 s到这里时，确保转为unicode</div>
</div>
<p>以上几步搞定后，你只需要关注两个 unicode和 你设定的编码(一般使用utf-8)</p>
<p>处理顺序</p>
<div class="line-block">
<div class="line">1. Decode early</div>
<div class="line">2. Unicode everywhere</div>
<div class="line">3. Encode later</div>
</div>
<p>相关模块及一些方法</p>
<p>获得和设置系统默认编码</p>
<div class="line-block">
<div class="line">&gt;&gt;&gt; import sys</div>
<div class="line">&gt;&gt;&gt; sys.getdefaultencoding()</div>
<div class="line">‘ascii’</div>
</div>
<div class="line-block">
<div class="line">&gt;&gt;&gt; reload(sys)</div>
<div class="line">&lt;module ‘sys’ (built-in)&gt;</div>
<div class="line">&gt;&gt;&gt; sys.setdefaultencoding(‘utf-8’)</div>
<div class="line">&gt;&gt;&gt; sys.getdefaultencoding()</div>
<div class="line">‘utf-8’</div>
</div>
<p>str.encode(‘other_coding’)</p>
<p>在python中，直接将某种编码的str进行encode成另一种编码str</p>
<div class="line-block">
<div class="line">#str_A为utf-8</div>
<div class="line">str_A.encode(‘gbk’)</div>
</div>
<div class="line-block">
<div class="line">执行的操作是</div>
<div class="line">str_A.decode(‘sys_codec’).encode(‘gbk’)</div>
<div class="line">这里sys_codec即为上一步 sys.getdefaultencoding() 的编码</div>
</div>
<p>‘获得和设置系统默认编码’和这里的str.encode是相关的，但我一般很少这么用，主要是觉得复杂不可控,还是输入明确decode，输出明确encode来得简单些(个人观点)</p>
<p>chardet</p>
<p>文件编码检测，<a class="reference external" href="https://pypi.python.org/pypi/chardet">下载</a></p>
<div class="line-block">
<div class="line">&gt;&gt;&gt; import chardet</div>
<div class="line">&gt;&gt;&gt; f = open(‘test.txt’,’r’)</div>
<div class="line">&gt;&gt;&gt; result = chardet.detect(f.read())</div>
<div class="line">&gt;&gt;&gt; result</div>
<div class="line">{‘confidence’: 0.99, ‘encoding’: ‘utf-8’}</div>
</div>
<p>\u字符串转对应unicode字符串</p>
<div class="line-block">
<div class="line">&gt;&gt;&gt; u’中’</div>
<div class="line">u’u4e2d’</div>
</div>
<div class="line-block">
<div class="line">&gt;&gt;&gt; s = ‘u4e2d’</div>
<div class="line">&gt;&gt;&gt; print s.decode(‘unicode_escape’)</div>
<div class="line">中</div>
</div>
<div class="line-block">
<div class="line">&gt;&gt;&gt; a = ‘<a class="reference external" href="file://u4fee/u6539/u8282/u70b9/u72b6/u6001/u6210/u529f">\u4fee\u6539\u8282\u70b9\u72b6\u6001\u6210\u529f</a>’</div>
<div class="line">&gt;&gt;&gt; a.decode(‘unicode_escape’)</div>
<div class="line">u’u4feeu6539u8282u70b9u72b6u6001u6210u529f’</div>
</div>
<p>python unicode文档</p>
<p><a class="reference external" href="http://docs.python.org/2/tutorial/introduction.html#unicode-strings">入口</a></p>
<p>好了，暂时就这么多，希望讲清楚了</p>
<p>thx</p>
<p>wklken</p>
<p>2013-08-31 于深圳</p>
</div></blockquote>
</div>
<div class="section" id="id3">
<h3>Python的中文编码问题<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h3>
<blockquote>
<div><p>字符串是Python中最常用的数据类型，而且很多时候你会用到一些不属于标准ASCII字符集的字符，这时候代码就很可能抛出UnicodeDecodeError: ‘ascii’ codec can’t decode byte 0xc4 in position 10: ordinal not in range(128)异常。这种异常在Python中很容易遇到，尤其是在Python2.x中，是一个很让初学者费解头疼的问题。不过，如果你理解了Python的Unicode，并在编码中遵循一定的原则，这种编码问题还是比较容易理解和解决的。</p>
<p>字符串在Python内部的表示是unicode编码，因此，在做编码转换时，通常需要以unicode作为中间编码，即先将其他编码的字符串解码（decode）成unicode，再从unicode编码（encode）成另一种编码。但是，Python 2.x的默认编码格式是ASCII，就是说，在没有指定Python源码编码格式的情况下，源码中的所有字符都会被默认为ASCII码。也因为这个根本原因，在Python 2.x中经常会遇到UnicodeDecodeError或者UnicodeEncodeError的异常。</p>
<p>关于Unicode</p>
<p>Unicode是一种字符集，它为每一种现代或古代使用的文字系统中出现的每一个字符都提供了统一的序列号，规定了符号的二进制代码，但没有规定这个二进制代码应该如何存储。也就是说：Unicode的编码方式是固定的，但是实现方式根据不同的需要有跟多种，常见的有UTF-8、UTF-16和UTF-32等。</p>
<p>为了能够处理Unicode数据，同时兼容Python某些内部模块，Python 2.x中提供了Unicode这种数据类型，通过decode和encode方法可以将其它编码和Unicode编码相互转化，但同时也引入了UnicodeDecodeError和UnicodeEncodeError异常。。</p>
<p>常见的几种编码异常</p>
<p>Python中常见的几种编码异常有SyntaxError: Non-ASCII character、UnicodeDecodeError和UnicodeEncodeError等。下面依次举例说明一下：</p>
<p>1、SyntaxError: Non-ASCII character</p>
<p>这种异常最不容易出现，也最容易处理，主要原因是Python源码文件中有非ASCII字符，而且同时没有声明源码编码格式，例如：</p>
<div class="line-block">
<div class="line">s = ‘中文’</div>
<div class="line">print s # 抛出异常</div>
</div>
<p>2、UnicodeDecodeError</p>
<p>这个异常有时候会在调用decode方法时出现，原因是Python打算将其他编码的字符转化为Unicode编码，但是字符本身的编码格式和decode方法传入的编码格式不一致，例如：</p>
<div class="line-block">
<div class="line">#!/usr/bin/python</div>
<div class="line"># – coding: utf-8 –</div>
<div class="line">s = ‘中文’</div>
<div class="line">s.decode(‘gb2312’) # UnicodeDecodeError: ‘gb2312’ codec can’t decode bytes in position 2-3: illegal multibyte sequence</div>
<div class="line">print s</div>
</div>
<p>上面这段代码中字符串s的编码格式是utf-8，但是在使用decode方法转化为Unicode编码时传入的参数是‘gb2312’，因此在转化的时候抛出UnicodeDecodeError异常。还有一种情况是在encode的时候：</p>
<div class="line-block">
<div class="line">#!/usr/bin/python</div>
<div class="line"># – coding: utf-8 –</div>
<div class="line">s = ‘中文’</div>
<div class="line">s.encode(‘gb2312’) # UnicodeDecodeError: ‘ascii’ codec can’t decode byte 0xe4 in position 0: ordinal not in range(128)</div>
<div class="line">print s</div>
</div>
<p>3、UnicodeEncodeError</p>
<p>错误的使用decode和encode方法会出现这种异常，比如：使用decode方法将Unicode字符串转化的时候：</p>
<div class="line-block">
<div class="line">#!/usr/bin/python</div>
<div class="line"># – coding: utf-8 –</div>
<div class="line">s = u’中文’</div>
<div class="line">s.decode(‘utf-8’) # UnicodeEncodeError: ‘ascii’ codec can’t encode characters in position 0-1: ordinal not in range(128)</div>
<div class="line">print s</div>
</div>
<p>当然，除了上面列出的几种出现异常的情况之外还有很多可能出现异常的例子，这里就不在一一说明了。</p>
<p>解决方法</p>
<p>对于以上的几个异常，有以下几个处理的方法和原则。</p>
<p>1、遵循PEP0263原则，声明编码格式</p>
<p>在PEP 0263 – Defining Python Source Code Encodings中提出了对Python编码问题的最基本的解决方法：在Python源码文件中声明编码格式，最常见的声明方式如下：</p>
<div class="line-block">
<div class="line">#!/usr/bin/python</div>
<div class="line"># – coding: &lt;encoding name&gt; –</div>
</div>
<p>其中是代码所需要的编码格式，它可以是任意一种Python支持的格式，一般都会使用utf-8的编码格式。</p>
<p>2、使用&nbsp;u’中文’&nbsp;替代&nbsp;‘中文’</p>
<div class="line-block">
<div class="line">str1 = ‘中文编码’</div>
<div class="line">str2 = u’中文编码’</div>
</div>
<p>Python中有以上两种声明字符串变量的方式，它们的主要区别是编码格式的不同，其中，str1的编码格式和Python文件声明的编码格式一致，而str2的编码格式则是Unicode。如果你要声明的字符串变量中存在非ASCII的字符，那么最好使用str2的声明格式，这样你就可以不需要执行decode，直接对字符串进行操作，可以避免一些出现异常的情况。</p>
<p>3、Reset默认编码</p>
<p>Python中出现这么多编码问题的根本原因是Python 2.x的默认编码格式是ASCII，所以你也可以通过以下的方式修改默认的编码格式：</p>
<div class="line-block">
<div class="line">import sys</div>
<div class="line">sys.setdefaultencoding(‘utf-8’)</div>
</div>
<p>这种方法是可以解决部分编码问题，但是同时也会引入很多其他问题，得不偿失，不建议使用这种方式。</p>
<p>4、终极原则：decode early, unicode everywhere, encode late</p>
<p>最后分享一个终极原则：decode early, unicode everywhere, encode late，即：在输入或者声明字符串的时候，尽早地使用decode方法将字符串转化成unicode编码格式；然后在程序内使用字符串的时候统一使用unicode格式进行处理，比如字符串拼接、字符串替换、获取字符串的长度等操作；最后，在输出字符串的时候（控制台/网页/文件），通过encode方法将字符串转化为你所想要的编码格式，比如utf-8等。</p>
<p>按照这个原则处理Python的字符串，基本上可以解决所有的编码问题（只要你的代码和Python环境没有问题）。。。</p>
<p>5、升级Python 2.x到3.x</p>
<p>额，最后一个方法，升级Python 2.x，使用Python 3.x版本。。这样说主要是为了吐槽Python 2.x的编码设计问题。当然，升级到Python 3.x肯定可以解决大部分因为编码产生的异常问题。毕竟Python 3.x版本对字符串这部分还是做了相当大的改进的，具体的下面会说。。。。</p>
<p>Python 3.x中的Unicode</p>
<p>在Python 3.0之后的版本中，所有的字符串都是使用Unicode编码的字符串序列，同时还有以下几个改进：</p>
</div></blockquote>
<ul class="simple">
<li>默认编码格式改为unicode</li>
<li>所有的Python内置模块都支持unicode</li>
<li>不再支持u’中文’的语法格式</li>
</ul>
<blockquote>
<div><p>所以，对于Python 3.x来说，编码问题已经不再是个大的问题，基本上很少遇到上述的几个异常。关于Python 2.x str&amp;unicode和Python 3.x str&amp;bytes的更多说明和对比，大家可以看一下：Python中字符编码的总结和对比</p>
<p>PS: 该文章转自我的博客：<a class="reference external" href="http://xianglong.me/article/learn-python-1-chinese-encoding/">Python的中文编码问题</a></p>
<p>Over!</p>
</div></blockquote>
</div>
</div>
<div class="section" id="centos-6-x-python">
<h2>CentOs 6.x 升级 Python 版本<a class="headerlink" href="#centos-6-x-python" title="永久链接至标题">¶</a></h2>
<blockquote>
<div>文章目录</div></blockquote>
<ol class="arabic simple">
<li><a class="reference external" href="https://ruiaylin.github.io/2014/12/12/python%20update/#在CentOS_6-X_上面安装_Python_2-7-X">1.&nbsp;在CentOS 6.X 上面安装 Python 2.7.X</a></li>
<li><a class="reference external" href="https://ruiaylin.github.io/2014/12/12/python%20update/#升级步骤">2.&nbsp;升级步骤</a></li>
<li><a class="reference external" href="https://ruiaylin.github.io/2014/12/12/python%20update/#更新系统和开发工具集">2.1.&nbsp;更新系统和开发工具集</a></li>
<li><a class="reference external" href="https://ruiaylin.github.io/2014/12/12/python%20update/#源码安装Python_2-7-x">2.2.&nbsp;源码安装Python 2.7.x</a></li>
<li><a class="reference external" href="https://ruiaylin.github.io/2014/12/12/python%20update/#安装详情：">2.2.1.&nbsp;安装详情：</a></li>
<li><a class="reference external" href="https://ruiaylin.github.io/2014/12/12/python%20update/#设置_PATH">2.2.2.&nbsp;设置 PATH</a></li>
<li><a class="reference external" href="https://ruiaylin.github.io/2014/12/12/python%20update/#安装_setuptools">2.2.3.&nbsp;安装 setuptools</a></li>
<li><a class="reference external" href="https://ruiaylin.github.io/2014/12/12/python%20update/#安装_PIP">2.3.&nbsp;安装 PIP</a></li>
<li><a class="reference external" href="https://ruiaylin.github.io/2014/12/12/python%20update/#修复_yum_工具">2.4.&nbsp;修复 yum 工具</a></li>
<li><a class="reference external" href="https://ruiaylin.github.io/2014/12/12/python%20update/#总结">3.&nbsp;总结</a></li>
</ol>
<blockquote>
<div><p>在CentOS 6.X 上面安装 Python 2.7.X</p>
<p>CentOS 6.X 自带的python版本是 2.6 , 由于工作需要，很多时候需要2.7版本。所以需要进行版本升级。由于一些系统工具和服务是对 Python 有依赖的，所以升级 Python 版本需要注意。</p>
<p>升级步骤</p>
<p>如何欢乐的，没有痛苦的升级python版本 ，往下看 …</p>
<p>更新系统和开发工具集</p>
<p>更新指令</p>
<div class="line-block">
<div class="line">yum -y update</div>
<div class="line">yum groupinstall -y ‘development tools’</div>
</div>
<p>另外还需要安装 python 工具需要的额外软件包 SSL, bz2, zlib</p>
<p>yum install -y zlib-devel bzip2-devel openssl-devel xz-libs wget</p>
<p>源码安装Python 2.7.x</p>
<div class="line-block">
<div class="line">wget <a class="reference external" href="http://www.python.org/ftp/python/2.7.8/Python-2.7.8.tar.xz">http://www.python.org/ftp/python/2.7.8/Python-2.7.8.tar.xz</a></div>
<div class="line">xz -d Python-2.7.8.tar.xz</div>
<div class="line">tar -xvf Python-2.7.8.tar</div>
</div>
<p>安装详情：</p>
<div class="line-block">
<div class="line"># 进入目录:</div>
<div class="line">cd Python-2.7.8</div>
<div class="line"># 运行配置 configure:</div>
<div class="line">./configure –prefix=/usr/local</div>
<div class="line"># 编译安装:</div>
<div class="line">make</div>
<div class="line">make altinstall</div>
<div class="line"># 检查 Python 版本:</div>
<div class="line">[<a class="reference external" href="mailto:root&#37;&#52;&#48;dbmasterxxx">root<span>&#64;</span>dbmasterxxx</a> ~]# python2.7 -V</div>
<div class="line">Python 2.7.8</div>
</div>
<p>设置 PATH</p>
<p>为了我们能够方便的使用Python，我们需要设置系统变量或者建立 软连接将新版本的 Python</p>
<p>加入到 path 对应的目录 ：</p>
<div class="line-block">
<div class="line">export PATH=”/usr/local/bin:$PATH”</div>
<div class="line">or</div>
<div class="line">ln -s /usr/local/bin/python2.7 /usr/bin/python</div>
<div class="line"># 检查</div>
<div class="line">[<a class="reference external" href="mailto:root&#37;&#52;&#48;dbmasterxxx">root<span>&#64;</span>dbmasterxxx</a> ~]# python -V</div>
<div class="line">Python 2.7.8</div>
<div class="line">[<a class="reference external" href="mailto:root&#37;&#52;&#48;dbmasterxxx">root<span>&#64;</span>dbmasterxxx</a> ~]# which python</div>
<div class="line">/usr/bin/python</div>
</div>
<p>安装 setuptools</p>
<div class="line-block">
<div class="line">#获取软件包</div>
<div class="line">wget –no-check-certificate <a class="reference external" href="https://pypi.python.org/packages/source/s/setuptools/setuptools-1.4.2.tar.gz">https://pypi.python.org/packages/source/s/setuptools/setuptools-1.4.2.tar.gz</a></div>
<div class="line"># 解压:</div>
<div class="line">tar -xvf setuptools-1.4.2.tar.gz</div>
<div class="line">cd setuptools-1.4.2</div>
<div class="line"># 使用 Python 2.7.8 安装 setuptools</div>
<div class="line">python2.7 setup.py install</div>
</div>
<p>安装 PIP</p>
<p>curl <a class="reference external" href="https://bootstrap.pypa.io/get-pip.py">https://bootstrap.pypa.io/get-pip.py</a> | python2.7 -</p>
<p>这样出来的pip就默认会装到 2.7 的目录下了</p>
<p>修复 yum 工具</p>
<p>此时yum应该是失效的，因为此时默认python版本已经是2.7了。而yum需要的是2.6 所以：</p>
<div class="line-block">
<div class="line">[<a class="reference external" href="mailto:root&#37;&#52;&#48;dbmasterxxx">root<span>&#64;</span>dbmasterxxx</a> ~]# which yum</div>
<div class="line">/usr/bin/yum</div>
<div class="line">#修改 yum中的python</div>
<div class="line">将第一行 #!/usr/bin/python 改为 #!/usr/bin/python2.6</div>
<div class="line">此时yum就ok啦</div>
</div>
<p>总结</p>
<p>Python 版本升级过很多遍，每次都有问题，此方法来自互联网，经过使用，没有问题，特此总结一下</p>
<p>来自 &lt;<a class="reference external" href="https://ruiaylin.github.io/2014/12/12/python%20update/">https://ruiaylin.github.io/2014/12/12/python%20update/</a>&gt;</p>
</div></blockquote>
</div>
</div>


        </div>



        <!-- 来必力City版安装代码 -->
        <div id="lv-container" data-id="city" data-uid="MTAyMC80MDU4Ni8xNzExMw==">
        <script type="text/javascript">
           (function(d, s) {
               var j, e = d.getElementsByTagName(s)[0];

               if (typeof LivereTower === 'function') { return; }

               j = d.createElement(s);
               j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
               j.async = true;

               e.parentNode.insertBefore(j, e);
           })(document, 'script');
        </script>
        <noscript>为正常使用来必力评论功能请激活JavaScript</noscript>
        </div>
        <!-- City版安装代码已完成 -->
      </div>
    </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="总目录"
             >索引</a></li>
        <li class="right" >
          <a href="../../bash_shell.html" title="Shell 编程"
             >下一页</a> |</li>
        <li class="right" >
          <a href="tools.html" title="工具"
             >上一页</a> |</li>
        <!--<li><a href="../../../index.html">首页</a>&#160;|</li>-->
        <!--<li><a href="../../../contents.html">Documentation</a> &#187;</li>-->

          <li class="nav-item nav-item-1"><a href="../py_notes.html" >Python 学习笔记</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; 版权所有 CC BY 2.5.
      由 <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.1 创建。
    </div>
  </body>
</html>